<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>VIP系统网络验证 &#8211; Neteen Blog</title> <meta name="description" content="occupied with moon theme of jelly"> <meta name="keywords" content="网络验证, VIP, php, 微信"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="http://localhost:4000/assets/img/logo.png"> <meta name="twitter:title" content="VIP系统网络验证"> <meta name="twitter:description" content="1.预估到了大客户的到来，前阵子脚本需要更新VIP录入机制了，因为用的是时间戳取部分特定格式MD5转码后取前几位本地判断。弊端：容易在一段时间内反复激活软件改进A:加入设备ID,MAC地址，IP限制判断。改进B:高端GPS和网络定位一定时间地区只允许激活一个设备改进C:引入手机登录验证，但是费时间后两者都已经脱离本地范畴了，本地设备易克隆，技术缺陷于是还是引入网络验证吧！"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="VIP系统网络验证"> <meta property="og:description" content="1.预估到了大客户的到来，前阵子脚本需要更新VIP录入机制了，因为用的是时间戳取部分特定格式MD5转码后取前几位本地判断。弊端：容易在一段时间内反复激活软件改进A:加入设备ID,MAC地址，IP限制判断。改进B:高端GPS和网络定位一定时间地区只允许激活一个设备改进C:引入手机登录验证，但是费时间后两者都已经脱离本地范畴了，本地设备易克隆，技术缺陷于是还是引入网络验证吧！"> <meta property="og:url" content="http://localhost:4000/vip-protected-system/"> <meta property="og:site_name" content="Neteen Blog"> <meta property="og:image" content="http://localhost:4000/assets/img/logo.png"> <link rel="canonical" href="http://localhost:4000/vip-protected-system/"> <link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Neteen Blog Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="http://localhost:4000/assets/css/main.css"> <!-- JS --> <script src="http://localhost:4000/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="http://localhost:4000/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="http://localhost:4000/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="http://localhost:4000/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="http://localhost:4000/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(http://localhost:4000/assets/img/placeholder-big2.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="http://localhost:4000/">Home</a></li> <li> <a href="#">关于</a> <ul class="dl-submenu"> <li> <img src="http://localhost:4000/assets/img/logo.png" alt="Neteen Blog photo" class="author-photo"> <h4>Neteen Blog</h4> <p>occupied with moon theme of jelly</p> </li> <li><a href="http://localhost:4000/about/"><span class="btn btn-inverse">详情</span></a></li> <li> <a href="http://instagram.com/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-instagram"></i> Instagram</a> </li> <li> <a href="http://github.com/jlwebs" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> <li> <a href="http://steamcommunity.com/id/username" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-steam-square"></i> Steam</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">文章</a> <ul class="dl-submenu"> <li><a href="http://localhost:4000/posts/">所有文章</a></li> <li><a href="http://localhost:4000/tags/">所有标签</a></li> </ul> </li> <li><a href="http://localhost:4000/projects/" >项目</a></li> <li><a href="//neteen.online">主站</a></li></ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>VIP系统网络验证</h1> <h4>23 Apr 2018</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> 阅读时长 ~1 分钟 </p><!-- /.entry-reading-time --> <a class="btn zoombtn" href="http://localhost:4000/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>1.预估到了大客户的到来，前阵子脚本需要更新VIP录入机制了，因为用的是时间戳取部分特定格式MD5转码后取前几位本地判断。<br /> 弊端：容易在一段时间内反复激活软件<br /> 改进A:加入设备ID,MAC地址，IP限制判断。<br /> 改进B:高端GPS和网络定位一定时间地区只允许激活一个设备<br /> 改进C:引入手机登录验证，但是费时间<br /> 后两者都已经脱离本地范畴了，本地设备易克隆，技术缺陷于是还是引入网络验证吧！</p> <p>2.简单一点，version对比验证<br /> 服务端 前台管理员可以微信扫码生成一个有效期一小时内的激活码，用后就销毁，本地写配置项，accepted!<br /> 具体：管理员扫码添加（CDKEY-&gt;MD5）到哈希表-&gt;用户输入CDKEY，POST请求返回MD5，本地验证MD5在有效期内，写配置项accepted。</p> <p>3.激活软件验证解决，但是激活后使用系统克隆，也是没辙的，本地一个配置项被克隆了，也等于激活了，所以每次启动都得网络认证一遍，<br /> 结论：对于安卓脚本辅助，不能依靠本地验证，以及首次激活认证！！</p> <p>4.重点就来了，验证要引入secret，而一个secret同时只有一个设备使用，这不是很像Session吗?于是温习一遍Session：</p> <h3 id="session-会话是为了解决http协议无状态stateless由于basic-auth单点认证频繁提交用户名密码敏感数据存在潜在不安全因素使用sessionid作为代替用户名密码">session 会话，是为了解决HTTP协议无状态（stateless），由于Basic auth单点认证频繁提交用户名密码敏感数据，存在潜在不安全因素，使用sessionID作为代替用户名密码</h3> <p>的通行证，举个例子，指纹支付代替输入支付密码。__</p> <p>我们来看看cookie有什么？</p> <h6 id="pstm1522651151-bidupsid6f3cc1428d304fe6ab8f663439dc87f5-bd_upn12314753-baiduid9f7d8f405fd61923008a26b4d92ce61cfg1-ispeed_lsm0-bdorzb490b5ebf6f3cd402e515d22bcda1598-h_ps_pssid1440_25809_21102_20929-bdsfrcvid5ilsjeccxg3akevadu18xbztztrx3jp4ojip3j-h_bdclckid_sfjbadodd-jcvbfp0kktr_mjqh-unlq5q0bt7z0lonmp05eqvn5xqf3jobw-5z-ptn-j-ebtt2ahcevko_e4bk-trljgdjtf5sugstore1-bd_ck_sam1-psino2-h_ps_645ec45c0fdlyj6pywksa6nqjjdutie9ve7zxxdzam9grobl3xr7szeok2bb1nkdpqwpp8f3bq-bdsvrtm0"><em>PSTM=1522651151; BIDUPSID=6F3CC1428D304FE6AB8F663439DC87F5; BD_UPN=12314753; BAIDUID=9F7D8F405FD61923008A26B4D92CE61C:FG=1; ispeed_lsm=0; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; H_PS_PSSID=1440_25809_21102_20929; BDSFRCVID=5iLsJeCCxG3AKevAdU18XBZtZTrx3jp4oJiP3J; H_BDCLCKID_SF=JbADoDD-JCvbfP0kKtr_MJQH-UnLq5Q0BT7Z0lOnMp05EqvN5xQf3jobW-5z-pTn-j-eBtt2ahcEVKO_e4bK-TrLjGDjtf5;sugstore=1; BD_CK_SAM=1; PSINO=2; H_PS_645EC=45c0fdLyJ6PyWksA6NqJJdUtie9ve7zxxDZAM9GRoBl3xr7szeOk%2Bb1NkDpQwpp8F3BQ; BDSVRTM=0</em></h6> <p>·再深入看看cookie格式</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pt_guid_sig
58712e29973bdec84f985fc374daaf4efe132efb59a3ff0ef48efb908ccbd06e
ptlogin2.qq.com/
66560
2761206912
30604703
2450715067
30598668
*
</code></pre></div></div> <h6 id="其中">其中</h6> <p>第1行为 Cookie 名称<br /> 第2行是 Cookie 的值<br /> 第3行是 Cookie 所属站点的地址<br /> 第4行是个标记值(注:准确来说应该是表示该Cookie是否被加密)<br /> 第5行为超时时间的低位(Cardinal/DWORD)<br /> 第6行为超时时间的高位<br /> 第7行为创建时间的低位<br /> 第8行为创建时间的高位<br /> 第9行固定为 * ，表示一节的结束</p> <p>一个文件可能包含有多个节，按上面的格式循环即可</p> <p>ssion.name:这个就是SessionID储存的变量名称，可能是Cookie来传递，也可能是Query_String来传递，默认值是”PHPSESSID” ，或者JSP中的”JSESSID”</p> <blockquote> <p>（tomcat的session的id值生成的机制是一个随机数加时间加上jvm的id值，jvm的id值会根据服务器的硬件信息计算得来，因此不同jvm的id值都是唯一的）</p> </blockquote> <p>我们看看服务端session如何储存的，session是由你的浏览器保存的，有着特定的数据格式，而且安全性高的浏览器还会对文件加权限，和其他cookies数据分离储存。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> hello|i:123;word|i:456;
</code></pre></div></div> <p>权力全在服务端，无需加密，随用随调取 <img src="../img/6.png" alt="Image Title" /> 但是console访问</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>console.log(document.cookie)
</code></pre></div></div> <p>如下</p> <blockquote> <p>_octo=GH1.1.2131036791.1504607001; _ga=GA1.2.1713614033.1504607001; tz=Asia%2FShanghai</p> </blockquote> <p>却拿不到关键的几个cookie，如sessionID 和 ServerSameSessionID 原来是每个对应cookie后端可以设置setHttpOnly（true），可以防止跨站脚本SESSION状态偷取，如下语句。</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cookie.setHttpOnly(true)
</code></pre></div></div> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="http://localhost:4000/tags/#网络验证" title="Pages tagged 网络验证" class="tag"><span class="term">网络验证</span></a><a href="http://localhost:4000/tags/#VIP" title="Pages tagged VIP" class="tag"><span class="term">VIP</span></a><a href="http://localhost:4000/tags/#php" title="Pages tagged php" class="tag"><span class="term">php</span></a><a href="http://localhost:4000/tags/#微信" title="Pages tagged 微信" class="tag"><span class="term">微信</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/vip-protected-system/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/vip-protected-system/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=http://localhost:4000/vip-protected-system/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"> <div id="lv-container" data-id="city" data-uid="MTAyMC8zMTk5MC84NTU0"> <script type="text/javascript"> (function(d, s) { var j, e = d.getElementsByTagName(s)[0]; if (typeof LivereTower === 'function') { return; } j = d.createElement(s); j.src = 'https://cdn-city.livere.com/js/embed.dist.js'; j.async = true; e.parentNode.insertBefore(j, e); })(document, 'script'); </script> <noscript>为正常使用来必力评论功能请激活JavaScript</noscript> </div> </section> </header> <!-- JS --> <script src="http://localhost:4000/assets/js/jquery-1.12.0.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.dlmenu.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.goup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.magnific-popup.min.js"></script> <script src="http://localhost:4000/assets/js/jquery.fitvid.min.js"></script> <script src="http://localhost:4000/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'neteen-blog'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
